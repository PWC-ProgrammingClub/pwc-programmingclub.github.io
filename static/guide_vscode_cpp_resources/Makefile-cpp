#	 Makefile: Used to facilite "make" and related commands.
#
#	 Acknowledgements/Credits:
#	 	1. Job Vranish - https://spin.atomicobject.com/2016/08/26/makefile-c-projects/
#		2. https://www.gnu.org/software/make/manual/html_node/Wildcard-Function.html
#

# See 1 in Acknowledgements/Credits
MAIN_EXEC := main
TEST_EXEC := test
OBJECT_DIRECTORY := bin
CXX := g++
MAIN_C := src/main.cpp
CLI_ARGS := 

O_FLAGS := -c

# See 2 in Acknowledgements/Credits
MAIN_SRCS := $(wildcard src/*.cpp)
TEST_SRCS := $(wildcard tests/*.cpp) $(filter-out $(MAIN_C), $(MAIN_SRCS))

MAIN_OBJS := $(MAIN_SRCS:%=$(OBJECT_DIRECTORY)/%.o)
TEST_OBJS := $(TEST_SRCS:%=$(OBJECT_DIRECTORY)/%.o)

INC_FLAGS := -Isrc -Wall

run: $(MAIN_EXEC)
	./$(MAIN_EXEC) $(CLI_ARGS)

tests: clean $(TEST_EXEC)
	./$(TEST_EXEC) $(CLI_ARGS)

clean:
	$(RM) $(MAIN_EXEC) $(TEST_EXEC)
	$(RM) -rf $(OBJECT_DIRECTORY)

all: clean run

$(OBJECT_DIRECTORY)/%.cpp.o: %.cpp
	mkdir -p $(dir $@)
	$(CXX) $(INC_FLAGS) $(O_FLAGS) $< -o $@

$(MAIN_EXEC): $(MAIN_OBJS)
	$(CXX) $(MAIN_OBJS) -o $@

$(TEST_EXEC): $(TEST_OBJS)
	$(CXX) $(TEST_OBJS) -o $@
